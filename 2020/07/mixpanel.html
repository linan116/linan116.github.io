<!DOCTYPE html>
<html style="display: none;" lang="zh">
    <head>
    <meta charset="utf-8">
    <!--
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.5.6 -->
    <script>
        window.materialVersion = "1.5.6"
        // Delete localstorage with these tags
        window.oldVersion = [
            'codestartv1',
            '1.3.4',
            '1.4.0',
            '1.4.0b1',
            '1.5.0',
            '1.5.2',
            '1.5.5'
        ]
    </script>

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">









    <link rel="dns-prefetch" href="https://fonts.googleapis.com"/>





    <!-- Meta & Info -->
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!-- Title -->
    
    <title>
        
            mixpanel系统架构 | 
        
        面子和里子
    </title>

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" href="/img/favicon.png">

    <meta name="format-detection" content="telephone=no"/>
    <meta name="description" itemprop="description" content="比特、数据、大数据">
    <meta name="keywords" content=",用户行为, 大数据, 分布式">
    <meta name="theme-color" content="#0097A7">

    <!-- Disable Fucking Bloody Baidu Tranformation -->
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import lsloader -->
    <script>(function(){window.lsloader={jsRunSequence:[],jsnamemap:{},cssnamemap:{}};lsloader.removeLS=function(a){try{localStorage.removeItem(a)}catch(b){}};lsloader.setLS=function(a,c){try{localStorage.setItem(a,c)}catch(b){}};lsloader.getLS=function(a){var c="";try{c=localStorage.getItem(a)}catch(b){c=""}return c};versionString="/*"+(window.materialVersion||"unknownVersion")+"*/";lsloader.clean=function(){try{var b=[];for(var a=0;a<localStorage.length;a++){b.push(localStorage.key(a))}b.forEach(function(e){var f=lsloader.getLS(e);if(window.oldVersion){var d=window.oldVersion.reduce(function(g,h){return g||f.indexOf("/*"+h+"*/")!==-1},false);if(d){lsloader.removeLS(e)}}})}catch(c){}};lsloader.clean();lsloader.load=function(f,a,b,d){if(typeof b==="boolean"){d=b;b=undefined}d=d||false;b=b||function(){};var e;e=this.getLS(f);if(e&&e.indexOf(versionString)===-1){this.removeLS(f);this.requestResource(f,a,b,d);return}if(e){var c=e.split(versionString)[0];if(c!=a){console.log("reload:"+a);this.removeLS(f);this.requestResource(f,a,b,d);return}e=e.split(versionString)[1];if(d){this.jsRunSequence.push({name:f,code:e});this.runjs(a,f,e)}else{document.getElementById(f).appendChild(document.createTextNode(e));b()}}else{this.requestResource(f,a,b,d)}};lsloader.requestResource=function(b,e,a,c){var d=this;if(c){this.iojs(e,b,function(h,f,g){d.setLS(f,h+versionString+g);d.runjs(h,f,g)})}else{this.iocss(e,b,function(f){document.getElementById(b).appendChild(document.createTextNode(f));d.setLS(b,e+versionString+f)},a)}};lsloader.iojs=function(d,b,g){var a=this;a.jsRunSequence.push({name:b,code:""});try{var f=new XMLHttpRequest();f.open("get",d,true);f.onreadystatechange=function(){if(f.readyState==4){if((f.status>=200&&f.status<300)||f.status==304){if(f.response!=""){g(d,b,f.response);return}}a.jsfallback(d,b)}};f.send(null)}catch(c){a.jsfallback(d,b)}};lsloader.iocss=function(f,c,h,a){var b=this;try{var g=new XMLHttpRequest();g.open("get",f,true);g.onreadystatechange=function(){if(g.readyState==4){if((g.status>=200&&g.status<300)||g.status==304){if(g.response!=""){h(g.response);a();return}}b.cssfallback(f,c,a)}};g.send(null)}catch(d){b.cssfallback(f,c,a)}};lsloader.iofonts=function(f,c,h,a){var b=this;try{var g=new XMLHttpRequest();g.open("get",f,true);g.onreadystatechange=function(){if(g.readyState==4){if((g.status>=200&&g.status<300)||g.status==304){if(g.response!=""){h(g.response);a();return}}b.cssfallback(f,c,a)}};g.send(null)}catch(d){b.cssfallback(f,c,a)}};lsloader.runjs=function(f,c,e){if(!!c&&!!e){for(var b in this.jsRunSequence){if(this.jsRunSequence[b].name==c){this.jsRunSequence[b].code=e}}}if(!!this.jsRunSequence[0]&&!!this.jsRunSequence[0].code&&this.jsRunSequence[0].status!="failed"){var a=document.createElement("script");a.appendChild(document.createTextNode(this.jsRunSequence[0].code));a.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(a);this.jsRunSequence.shift();if(this.jsRunSequence.length>0){this.runjs()}}else{if(!!this.jsRunSequence[0]&&this.jsRunSequence[0].status=="failed"){var d=this;var a=document.createElement("script");a.src=this.jsRunSequence[0].path;a.type="text/javascript";this.jsRunSequence[0].status="loading";a.onload=function(){d.jsRunSequence.shift();if(d.jsRunSequence.length>0){d.runjs()}};document.body.appendChild(a)}}};lsloader.tagLoad=function(b,a){this.jsRunSequence.push({name:a,code:"",path:b,status:"failed"});this.runjs()};lsloader.jsfallback=function(c,b){if(!!this.jsnamemap[b]){return}else{this.jsnamemap[b]=b}for(var a in this.jsRunSequence){if(this.jsRunSequence[a].name==b){this.jsRunSequence[a].code="";this.jsRunSequence[a].status="failed";this.jsRunSequence[a].path=c}}this.runjs()};lsloader.cssfallback=function(e,c,b){if(!!this.cssnamemap[c]){return}else{this.cssnamemap[c]=1}var d=document.createElement("link");d.type="text/css";d.href=e;d.rel="stylesheet";d.onload=d.onerror=b;var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(d,a)};lsloader.runInlineScript=function(c,b){var a=document.getElementById(b).innerText;this.jsRunSequence.push({name:c,code:a});this.runjs()}})();</script>

    <!-- Import queue -->
    <script>function Queue(){this.dataStore=[];this.offer=b;this.poll=d;this.execNext=a;this.debug=false;this.startDebug=c;function b(e){if(this.debug){console.log("Offered a Queued Function.")}if(typeof e==="function"){this.dataStore.push(e)}else{console.log("You must offer a function.")}}function d(){if(this.debug){console.log("Polled a Queued Function.")}return this.dataStore.shift()}function a(){var e=this.poll();if(e!==undefined){if(this.debug){console.log("Run a Queued Function.")}e()}}function c(){this.debug=true}}var queue=new Queue();</script>

    <!-- Import CSS -->
    
        <style id="material_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_css","/css/material.min.css?Z7a72R1E4SxzBKR/WGctOA==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
        <style id="style_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("style_css","/css/style.min.css?NKhlKQkXw/c66TR5p4wO+w==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>

        

    

    

    <!-- Config CSS -->

<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
    overflow-x: hidden !important;
  }
  
  code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-color: #F5F5F5;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>


<!-- Import Font -->
<!-- Import Roboto -->

    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet">


<!-- Import Material Icons -->


    <style id="material_icons"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_icons","/css/material-icons.css?pqhB/Rd/ab0H2+kZp0RDmw==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>




    <!-- Import jQuery -->
    
        <script>lsloader.load("jq_js","/js/jquery.min.js?qcusAULNeBksqffqUM2+Ig==", true)</script>
    

    <!-- WebAPP Icons -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="面子和里子">
    <meta name="msapplication-starturl" content="https://linan116.github.io/2020/07/mixpanel.html">
    <meta name="msapplication-navbutton-color" content="#0097A7">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="面子和里子">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon" href="/img/favicon.png">

    <!-- Site Verification -->
    
    

    <!-- RSS -->
    

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="https://linan116.github.io/2020/07/mixpanel.html">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="mixpanel系统架构 | 面子和里子">
    <meta property="og:image" content="/img/favicon.png">
    <meta property="og:description" content="比特、数据、大数据">
    <meta property="og:article:tag" content="用户行为, 大数据, 分布式"> 

    
        <meta property="article:published_time" content="Wed Jul 01 2020 20:52:34 GMT+0800">
        <meta property="article:modified_time" content="Wed Jul 01 2020 21:19:03 GMT+0800">
    

    <!-- The Twitter Card protocol -->
    <meta name="twitter:card" content="summary_large_image">

    <!-- Add canonical link for SEO -->
    
        <link rel="canonical" href="https://linan116.github.io/2020/07/mixpanel.html" />
    

    <!-- Structured-data for SEO -->
    
        


<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage": "https://linan116.github.io/2020/07/mixpanel.html",
    "headline": "mixpanel系统架构",
    "datePublished": "Wed Jul 01 2020 20:52:34 GMT+0800",
    "dateModified": "Wed Jul 01 2020 21:19:03 GMT+0800",
    "author": {
        "@type": "Person",
        "name": "linan116",
        "image": {
            "@type": "ImageObject",
            "url": "/img/avatar.png"
        },
        "description": "比特的世界"
    },
    "publisher": {
        "@type": "Organization",
        "name": "面子和里子",
        "logo": {
            "@type":"ImageObject",
            "url": "/img/favicon.png"
        }
    },
    "keywords": ",用户行为, 大数据, 分布式",
    "description": "比特、数据、大数据",
}
</script>


    

    <!-- Analytics -->
    
    
    

    <!-- Custom Head -->
    

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?935657d4121683e3455c0b94ca64b520";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<meta name="generator" content="Hexo 4.2.1"></head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span id="MD-burger-id" class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->


    <!-- Left aligned menu below button -->
    
    
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh; overflow-y:scroll;">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#介绍"><span class="post-toc-number">1.</span> <span class="post-toc-text">介绍</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#用户为中心的数据模型"><span class="post-toc-number">2.</span> <span class="post-toc-text">用户为中心的数据模型</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#mixpanel-schema"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">mixpanel schema</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#以用户为中心的产品"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">以用户为中心的产品</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#用户标识符的管理"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">用户标识符的管理</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#摄取（Ingestion）"><span class="post-toc-number">3.</span> <span class="post-toc-text">摄取（Ingestion）</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#存储（Storage）"><span class="post-toc-number">4.</span> <span class="post-toc-text">存储（Storage）</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#列式存储"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">列式存储</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#列式存储数据格式"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">列式存储数据格式</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#数据分片"><span class="post-toc-number">4.3.</span> <span class="post-toc-text">数据分片</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#可扩展性与可靠性"><span class="post-toc-number">4.4.</span> <span class="post-toc-text">可扩展性与可靠性</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#查询（Query）"><span class="post-toc-number">5.</span> <span class="post-toc-text">查询（Query）</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#查询接口"><span class="post-toc-number">5.1.</span> <span class="post-toc-text">查询接口</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#查询过程"><span class="post-toc-number">5.2.</span> <span class="post-toc-text">查询过程</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#安全性"><span class="post-toc-number">6.</span> <span class="post-toc-text">安全性</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Mixpanel技术栈中的安全"><span class="post-toc-number">6.0.1.</span> <span class="post-toc-text">Mixpanel技术栈中的安全</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#总结"><span class="post-toc-number">7.</span> <span class="post-toc-text">总结</span></a></li></ol>
    </ul>
    




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        
            <!-- Random Thumbnail -->
            <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
            <script type="text/ls-javascript" id="post-thumbnail-script">
    var randomNum = Math.floor(Math.random() * 19 + 1);

    $('.post_thumbnail-random').attr('data-original', '/img/random/material-' + randomNum + '.png');
    $('.post_thumbnail-random').addClass('lazy');
</script>

        
    
            <p class="article-headline-p">
                mixpanel系统架构
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.png" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>linan116</strong>
        <span>7月 01, 2020</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/%E7%94%A8%E6%88%B7%E8%A1%8C%E4%B8%BA-%E5%A4%A7%E6%95%B0%E6%8D%AE-%E5%88%86%E5%B8%83%E5%BC%8F/" rel="tag">用户行为, 大数据, 分布式</a>
    </ul>
    

    <!-- Share -->
    
        <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=mixpanel系统架构&url=https://linan116.github.io/2020/07/mixpanel.html&pic=https://linan116.github.io/img/favicon.png&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                分享到微博
            </li>
        </a>
    

    <!-- Share Twitter -->
    

    <!-- Share Facebook -->
    

    <!-- Share Google+ -->
    

    <!-- Share LinkedIn -->
    
        <a class="post_share-link" href="https://www.linkedin.com/shareArticle?mini=true&url=https://linan116.github.io/2020/07/mixpanel.html&title=mixpanel系统架构" target="_blank">
            <li class="mdl-menu__item">
                分享到 LinkedIn
            </li>
        </a>
    

    <!-- Share QQ -->
    
        <a class="post_share-link" href="http://connect.qq.com/widget/shareqq/index.html?site=面子和里子&title=mixpanel系统架构&summary=比特、数据、大数据&pics=https://linan116.github.io/img/favicon.png&url=https://linan116.github.io/2020/07/mixpanel.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 QQ
            </li>
        </a>
    

    <!-- Share Telegram -->
    
</ul>

    
</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <p>作者：Vijay Jayaram</p>
<p>时间：June 2018</p>
<p>译者：linan116</p>
<h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><p>Mixpanel是一个用户分析平台，它让任何人都可以从数据中学习并采取行动。它从遍布全世界的客户的网站和移动App中获取数据并通过可交互的用户界面生成汇总的报告。为了能够提供一个强有力的，支持大规模用户分析的工具，我们花费了数年时间搭建自已的数据库，名叫Arb。在这篇文章中，我们将深入系统架构之中，一探究竟。</p>
<p>我们内部开发了Arb来满足自身严苛的需求：</p>
<ul>
<li>以用户为中心：Arb是一个定制开发的数据库，为了满足复杂的以用户为中心的查询请求</li>
<li>速度：多数的查询响应时间都少于1秒</li>
<li>实时：采集的数据在1分钟之内即可被查询</li>
<li>可扩展：我们每天采集TB规模的数据，单个查询通常扫描100GB。我们使用Google Cloud，可以进行有效的扩展以满足客户的需求。</li>
</ul>
<p>相关数字：</p>
<ul>
<li>Mixpanel一年接收超过8万亿条的新数据</li>
<li>Mixpanel的查询引擎每天处理20,000TB的数据以及超过数百万次的查询</li>
<li>Mixpanel的存储系统存储了超过1PB的压缩数据</li>
<li>包括采集与查询处理，系统的稳定运行时间超过99.99%</li>
<li>Mixpanel符合SOC2，ISO27001数据中心，GDPR和EU Privacy Shield标准，同时也符合PCI DSS和HIPAA的规范</li>
</ul>
<p>Mixpanel的架构可以分为3个主要的部分：</p>
<ul>
<li>数据摄取：接收客户产品发送的数据，并将其进行存储</li>
<li>数据存储：提供了一个分布式、可复制，列式的数据存储</li>
<li>数据查询：接收客户的查询，返回聚合的、可视化的数据</li>
</ul>
<img src="/2020/07/mixpanel/architecture_overview.png" class="">

<p>接下来我们会按顺序介绍相关的组件。对于其它一些组件，诸如消息处理、A/B测试以及机器学习等，我们会在以后的文档中再进行介绍。</p>
<h1 id="用户为中心的数据模型"><a href="#用户为中心的数据模型" class="headerlink" title="用户为中心的数据模型"></a>用户为中心的数据模型</h1><p>Mixpanel数据模型的设计，围绕着如何理解客户产品中的用户行为。客户会发送数据到Mixpanel的项目中。每条数据包括事件（Event）或用户（user）的信息。当用户在产品上进行一个操作时，客户会发送一条事件数据。当获取用户的新信息时，会发送或更新用户的数据，比如注册。图2显示了一个样例项目的数据。</p>
<p>事件Event数据：</p>
<table>
<thead>
<tr>
<th>TIMESTAMP</th>
<th>USERID</th>
<th>EVENT</th>
<th>OS</th>
<th>NAME</th>
<th>ITEM</th>
</tr>
</thead>
<tbody><tr>
<td>2016-12-15T08:02</td>
<td>qrt-345</td>
<td>Browse</td>
<td>iPhone</td>
<td></td>
<td>raincoat</td>
</tr>
<tr>
<td>2016-12-15T08:05</td>
<td>qrt-345</td>
<td>Signup</td>
<td>iPhone</td>
<td>Janet</td>
<td></td>
</tr>
<tr>
<td>2016-12-15T08:07</td>
<td>pnm-321</td>
<td>AddToCart</td>
<td>Android</td>
<td></td>
<td>popcorn</td>
</tr>
<tr>
<td>2016-12-15T08:10</td>
<td>Janet</td>
<td>AddToCart</td>
<td>iPhone</td>
<td></td>
<td>raincoat</td>
</tr>
<tr>
<td>2016-12-15T08:10</td>
<td>Vijay</td>
<td>AddToCart</td>
<td>iPhone</td>
<td></td>
<td>chocolate</td>
</tr>
<tr>
<td>2016-12-15T08:15</td>
<td>Janet</td>
<td>Checkout</td>
<td>iPhone</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>人People数据：</p>
<table>
<thead>
<tr>
<th>USERID</th>
<th>EMAIL</th>
<th>COUNTRY</th>
<th>PHONE</th>
<th>FIRST PURCHASE DATE</th>
<th>NUMBER OF PURCHASES</th>
</tr>
</thead>
<tbody><tr>
<td>Janet</td>
<td><a href="mailto:janet@mixpanel.com">janet@mixpanel.com</a></td>
<td>US</td>
<td>650-555-1234</td>
<td>2016-12-15</td>
<td>1</td>
</tr>
<tr>
<td>Vijay</td>
<td><a href="mailto:vijay@dogsrus.nl">vijay@dogsrus.nl</a></td>
<td>NL</td>
<td></td>
<td>2016-02-19</td>
<td>7</td>
</tr>
<tr>
<td>Jessica</td>
<td><a href="mailto:jw@gogogo.com">jw@gogogo.com</a></td>
<td>US</td>
<td>914-555-5678</td>
<td>2015-07-29</td>
<td>12</td>
</tr>
</tbody></table>
<p>别名Alias数据：</p>
<table>
<thead>
<tr>
<th>NAMED_USERID (ALIAS)</th>
<th>ORIGINAL_USERID</th>
</tr>
</thead>
<tbody><tr>
<td>Jessica</td>
<td>abc-123</td>
</tr>
<tr>
<td>Jessica</td>
<td>azy-456</td>
</tr>
<tr>
<td>Janet</td>
<td>qrt-345</td>
</tr>
<tr>
<td>Vijay</td>
<td>xyz-789</td>
</tr>
</tbody></table>
<h2 id="mixpanel-schema"><a href="#mixpanel-schema" class="headerlink" title="mixpanel schema"></a>mixpanel schema</h2><p>Mixpanel的数据模型由事件和人的表组成。</p>
<ul>
<li>Event表记录用户的行为数据。包括：<ul>
<li>timestamp：时间戳，用户何时进行的操作</li>
<li>identifier：用户识别符，记录谁执行了操作</li>
<li>event name：事件名称，做了什么操作</li>
<li>properties：属性，描述事件的更多信息，如对于“购买”事件描述具体购买的商品</li>
</ul>
</li>
<li>People表记录用户。包括：<ul>
<li>identifier： 用户操作符，用作记录是谁，同时也应用在event数据中</li>
<li>properties：描述用户的更多信息。有些信息是用户直接提供的，如注册或首次交易时提供的email或邮寄地址。有些是更新的信息，如用户积累的购买次数或最近购买日期。</li>
</ul>
</li>
</ul>
<p>Event和People表都拥有一个灵活的结构。所有的事件记录都包括一个时间戳、用户标识符以及事件名称。所有的用户记录也包括用户标识符，可以用来与该用户的事件数据进行join查询。除此之外，剩下的数据结构就是所谓的属性（Properties），对于每一条不同的数据，它的结构可能都是不同的。大多数时候，对于同一个事件类型（指事件名称相同的数据），属性基本上固定的结构或者说是高度重合的。但是，对于不同的事件类型，属性中重复的内容很少。</p>
<p>Event记录是不可以修改的：它们都是一次性发送过来，再也不会发生改变。唯一的例外是为了符合GDPR的要求，如果用户请求删除它们的数据，那么我们需要将其相关数据进行删除操作。People的记录数据是可以修改的：他们包含了用户最近的信息，可能随时会发生改变。</p>
<h2 id="以用户为中心的产品"><a href="#以用户为中心的产品" class="headerlink" title="以用户为中心的产品"></a>以用户为中心的产品</h2><p>Mixpanel的特点是分析用户的行为：在使用产品时，用户最喜欢做什么以及最不喜欢做什么？以用户为中心的数据模型使得这些特点可以方便地让客户去使用，同时对我们来说，实现起来也比较高效。</p>
<ul>
<li>洞察：洞察报告可以根据事件和用户的属性数据，进行任意维度的切分。如果用户标识符同时存在于事件和用户记录中，那么就可以进行join查询；在报表的UI中，用户属性可以作为事件的属性进行显示并使用。此外，通过去用户标识符进行去重的统计，可以用来计算常见的指标：日活（DAU）。</li>
<li>漏斗：漏斗报表确定了用户经过一系列事件操作的转化率。举一个电子商务的例子，我们可以定义一个漏斗，它包括“查看商品”，“添加到购物车”，“购买商品”一系列事件操作，从漏斗中可以看到通过每个步骤的用户情况。与洞察功能类型，漏斗功能也支持通过事件和用户的属性进行过滤与分群。漏斗的需求并不是超前的，而应该早就存在的。</li>
<li>留存：留存报表用来分析用户的事件序列，用来判断产品对于用户的黏性。留存报表将用户按照他们首先触发事件的时间进行分组统计，然后再对其在时间窗口内触发另一个事件进行汇总统计用户数。留存同样可以按照属性进行过滤和分群操作。</li>
<li>消息：这里的消息是指通过Email或移动App的消息推送，将消息发送给某些用户。用户群可以是所有用户，也可以是根据数据属性或事件过滤的用户群。连接事件数据和用户数据的用户标识符，就包括email。</li>
</ul>
<p>请注意，用户标识符对于接下来的内容非常重要，它使得Mixpanel可以根据用户对事件分组。</p>
<h2 id="用户标识符的管理"><a href="#用户标识符的管理" class="headerlink" title="用户标识符的管理"></a>用户标识符的管理</h2><p>对用户标识符进行管理，可以保证识别出同一个用户生成的event数据和people数据。大多数时候，用户标识符是足以用来识别一个用户的所有事件数据的。准确地识别每一个事件的用户对于以用户为中心的数据分析来说，是非常重要的。但是，匿名用户和一个用户使用多台设备的情况，会让情况变得非常复杂。更有甚者，同一个用户有多个用户标识符。</p>
<ul>
<li>匿名用户：单个用户可能拥有多个用户标识符，例如，在注册之前他们在匿名状态下，执行了一些操作。在注册之前，每个用户都会有一个随机生成的hash值作为用户标识符。当他们注册之后，会选择一个不同的用户标识符，如帐号、email地址等。例如，在图2中，用户”qrt-123”，在后面会被标注为“Janet”。我们需要识别出“qrt-123”在8:02的事件数据和“Janet”在8:10的事件数据，都属于同一个用户。</li>
<li>多设备：一个用户首先在笔记本上识别为“qrt-123”，登录后被识别为“Janet”。而在她的手机上，开始被识别为“sdr-234”，随后被识别为“Janet”。那么我们就需要把“qrt-123”，“sdr-234”以及“Janet”均识别为同一个用户。</li>
</ul>
<p>同一个用户的不同用户标识符必须进行整合，以便正确的进行Mixpanel的相关功能计算。例如，为了计算日活DAU，每一个用户必须仅使用一个用户标识符。如果一个用户有多个用户标识符，那么DAU的数据就会虚增。为了计算漏斗，必须追溯一个用户在整个时间段内的所有事件流。例如，一个购买流程开始于手机上的浏览，结束于笔记本电脑上的信用卡支付。</p>
<p>Mixpanel利用用户别名Alias，解决了用户标识符管理的问题。用户别名作为用户标识符，在event和people数据记录中被发送上来，但是在数据摄取和存储的时候可以被不同的用户标识符替换。在上面的例子中，“Janet”和“sdr-234”都变成了“qrt-123”的别名。在Mixpanel存储的数据中，包括相同用户的所有的event和people数据都含有相同的用户标识符。</p>
<h1 id="摄取（Ingestion）"><a href="#摄取（Ingestion）" class="headerlink" title="摄取（Ingestion）"></a>摄取（Ingestion）</h1><p>Mixpanel每年从客户方接收超过8万亿条数据。让我们跟踪了解一下一个event数据在系统内的生命周期是怎样的：</p>
<ol>
<li>用户设备发送event数据到<a href="https://api.mixpanel.com/track" target="_blank" rel="noopener">https://api.mixpanel.com/track</a></li>
<li>请求被我们的DNS路由到全球分布的机器上</li>
<li>验证event数据，并将其推入消息队列中</li>
<li>一个ETL处理进程运行在中心Google Cloud区域，从消息队列中消息event数据，执行数据检验，别名识别以及将记录路由到存储系统</li>
<li>我们的存储系统摄取event数据，快速将其持久化成文件，并在Google的Persistent Disk环境下进行复制与加密。在这个时候，数据就可以被查询到了。</li>
<li>经过一段时间，一批event数据将被索引成一个查询更高效、列式存储的格式，并上传到Google Cloud存储中。</li>
</ol>
<p>99%的记录从抵达服务器到可被查询，花费时间不超过1分钟。这就是为什么Mixpanel可以提供实时分析的原因。</p>
<img src="/2020/07/mixpanel/ingestion.png" class="">

<p>ETL处理程序还会将每条记录以kv形式存储用于实时报表。实时报表提供了一个实时查询数据记录，方便调试以及理解数据的功能。</p>
<h1 id="存储（Storage）"><a href="#存储（Storage）" class="headerlink" title="存储（Storage）"></a>存储（Storage）</h1><p>Mixpanel的数据存储是一个分布式的，以用户为中心的基于事件的数据库，用于数十亿级事件数据的交互式分析。</p>
<h2 id="列式存储"><a href="#列式存储" class="headerlink" title="列式存储"></a>列式存储</h2><p>Mixpanel的数据原本是行式的：一个json对象描述了event或people记录的数据。但是列式存储的布局变成了分析型数据存储的标准。分析式的查询一般仅针对每条记录中的几列进行聚合的操作。列式存储允许查询仅仅访问需要的列，对于单列也可以进行更快的扫描。</p>
<p>在2015年，我们为Mixpanel开发一个新的列式存储系统。主要的原因是考虑功能性以及性能。</p>
<p><strong>功能性</strong>：Mixpanel的数据格式比较灵活，没有固定的schema。我们需要处理一些没有申明的属性，有可能每条数据都发生变化。大多数的数据存储对schema的修改要求都很严苛。</p>
<p><strong>性能</strong>：Mixpanel的数据和查询都是以用户为中心的。为了控制数据的布局与数据分布，我们对数据和查询进行了优化，通过了解数据布局，降低查询计划的消耗，减少执行步骤，减少网络数据传输，以便达到更快的查询。</p>
<ul>
<li>数据在分布式的环境下，按照userid进行分片存储。因此，单个用户所有的event数据都将保存在同一台机器上。</li>
<li>查询过程能够利用每个用户在同一台机器上的所有数据。例如，可以在每台服务器上对DAU进行独立的计算。类似的，漏斗的计算可以在一台机器上将某一个用户的所有历史event数据进行计算。</li>
</ul>
<p>列式存储对数据进行10倍的压缩，同时允许查询仅访问需要的列，这样就可以更迅速和有效的得到查询结果。当我们将存储转为列式之后，查询的等待时间提升了将近5倍，CPU使用率降低了10倍。结果我只需要更少的硬件就可以达到相同的查询负载要求。我们也有足够的查询能力去添加新的查询功能，比如通知和自动分群。</p>
<h2 id="列式存储数据格式"><a href="#列式存储数据格式" class="headerlink" title="列式存储数据格式"></a>列式存储数据格式</h2><img src="/2020/07/mixpanel/column_store.png" class="">

<p>接下来，我们介绍一下列式存储的数据格式。对于Mixpanel中的每一个项目，每天都会创建一个列式存储的文件。每个文件分4个部分（section），如上图所示：</p>
<ul>
<li>Header：开始和结束的时候戳，event的数量，后续section的地址以及其它的元数据</li>
<li>Dictionaries：3个不同的字典，分别对应属性名称、属性值以及userid</li>
<li>Index：每个event的每个属性的位置，按event名称，property名称排序</li>
<li>Data（Columns）：value的数量加上所有event所有properties的实际的值</li>
</ul>
<p>每个字典都使用LZ4压缩算法，存储在文件中。一个属性的值存储在一个数据段中，并按事件的时间戳进行排序。属性的值或者保存原始值，或者利用字典进行索引，无论哪种都对属性进行压缩处理。对重复值使用RLE，对整数使用字节打包，同时利用索引节省空间。</p>
<h2 id="数据分片"><a href="#数据分片" class="headerlink" title="数据分片"></a>数据分片</h2><p>数据是被切分保存的，系统中数据以用户标识符作为key进行分片处理，保证了一个用户的所有数据都保存在同一台服务器上。为了能够支持灾备，我们在两个不同区域维护了多份数据的复制。为了增加可靠性，所有数据都会生成定期的快照保存在Google Cloud Storage（GCS）中。考虑到成本和扩展因素，历史数据同样会持久化在GCS中。</p>
<p>在数据摄取的过程中，每个区域的存储服务器都会消费所在机器上的分片数据，将他们保存为行式的存储文件，使得这些数据可以被立即查询到。同时，一个索引的进程在后端运行，将这些行式的存储文件转化为我们的列式存储格式。这样既压缩的数据，又提升了查询的性能。查询操作既可以从行式存储，也可以从列式存储中读取数据。</p>
<h2 id="可扩展性与可靠性"><a href="#可扩展性与可靠性" class="headerlink" title="可扩展性与可靠性"></a>可扩展性与可靠性</h2><p>数以百计的切片数据为数据摄取和查询提供了高扩展性。我们的系统可以随着数据的增长对其进行重新分片，所以支持水平扩展。</p>
<p>每个切片会有多份复制，这样的话只要有一份复制在，数据就不会丢失。Mixpanel因此在处理机器升级和错误的情况下，不会造成数据的丢失以及不可用的情况发生。数据摄取与查询维持稳定运行时间达到了99.98%。</p>
<h1 id="查询（Query）"><a href="#查询（Query）" class="headerlink" title="查询（Query）"></a>查询（Query）</h1><h2 id="查询接口"><a href="#查询接口" class="headerlink" title="查询接口"></a>查询接口</h2><p>Mixpanel的客户可以有多种方式进行数据的查询。他们可以通过浏览器，在Mixpanel的UI上进行操作，或通过手机上Mixpanel的App，或通过调用Mixpanel提供了查询API接口。</p>
<p>客户可以在Mixpanle的UI上创建以及查看数据报表。每一张报表都会通过一次或多次调用查询的API获取数据，并进行可视化的展示。在界面中有许多功能强大的报表类型，如分群、漏斗、留存等报表。客户也可以通过在Mixpanel的App上操作创建以及查看指标。</p>
<p>最后，客户可以直接调用查询的API。有些客户通过脚本查询，定期查看指标。另一些客户将查询嵌入到其它的应用内，将数据展示给他们的用户。这些应用场景均可以通过UI查询提供支持。</p>
<h2 id="查询过程"><a href="#查询过程" class="headerlink" title="查询过程"></a>查询过程</h2><p>为了查询的高性能、实时以及以用户为中心，Mixpanel自建了查询的技术栈。Distributed Query Server（DQS）负责接收查询请求，请求被分发到许多Local Query Servers（LQS）进行并行计算。查询同时基于历史数据以及实时获取的数据，以便提供实时的查询结果。每一个LQS将结果返回给DQS执行聚合操作，并将最终结果返回给客户。</p>
<img src="/2020/07/mixpanel/query.png" class="">

<p>2017年，我们基于Google的云平台对查询引擎进行了云原生的重构。其中一项就是解耦了存储层与计算层，以便可以对这两层分别进行扩展。当客户采集了更大规模的数据之后，我们的存储层可以无缝地进行扩展，保证安全可靠的存储。当客户进行海量复杂的查询时，我们使用数以千计的CPU核在几秒钟内计算TB级的数据。我们的MPP架构，结合我们对用户分析的系列优化，提供了独一无二的速度与扩展上的优势。</p>
<p>我们的基础设施为我们更高级的功能打下了基础，比如Messages和自动洞察。Messages就是由我们实时的能力所支撑，客户能够对数据进行及时、自动化的操作。我们的高级机器学习功能，像异常检测和自动分群等运行得非常棒，因为我们的模型每天都基于万亿级的数据进行训练。如果没有这些构成Mixapnel基础的可扩展的基础架构，想要达到这样的效果是不可能的。</p>
<h1 id="安全性"><a href="#安全性" class="headerlink" title="安全性"></a>安全性</h1><h3 id="Mixpanel技术栈中的安全"><a href="#Mixpanel技术栈中的安全" class="headerlink" title="Mixpanel技术栈中的安全"></a>Mixpanel技术栈中的安全</h3><p>安全是Mixpanel技术栈中必须要考虑的部分，体现在以下几个方面：</p>
<p><strong>逻辑数据隔离</strong>：客户所有的数据都会根据所属项目进行信息标注，而且这个信息在架构中的每一层都是有效的，从而保证了数据的请求的合法性，仅针对所属项目返回相应的数据。</p>
<p><strong>数据保护</strong>：我们的生产环境与公网之间有严格限制的防火墙，而且所有客户的数据都是加密的。</p>
<p><strong>审计</strong>：对于访问客户数据和生产系统的个人，有着严格的限制，必须有书面的许可。同时，所有的数据访问行为都会被定期审核，以防数据被滥用。</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>Mixpanel提供了一个快速、可扩展、可靠以及安全的产品分析平台。接下来的图表总结了Mixpanel的架构设计是如何提供速度、扩展性、可靠性和安全性的。</p>
<p>Mixpanel产品分析平台的架构服务超过20000家客户，包括BMW、DocuSign、US Bank和Microsoft。我们了解到他们利用我们的产品帮忙他们回答了绝大多数用户与产品的问题，所以我们对于我们系统的性能、可靠性和安全性非常重视。我们有将近三分之一的工程师负责创建这篇文章中提及的采集、存储和查询系统。同时，我们每天都在从功能和性能上对其进行优化。</p>
<table>
<thead>
<tr>
<th></th>
<th>Ingestion</th>
<th>Storage</th>
<th>Query</th>
</tr>
</thead>
<tbody><tr>
<td>速度 Speed</td>
<td>对不同数据量的客户使用不同的消息队列</td>
<td>自定义分布式列式存储，基于Google Cloud Platform扩展</td>
<td>分布式处理，仅读取需要的列，本地数据缓存，根据切片的复制进行任务划分</td>
</tr>
<tr>
<td>扩展性 Scale</td>
<td>很多http服务器和消息队列。可根据需求水平扩展，增加新的服务器</td>
<td>许多的数据分片</td>
<td>数据分片的本地处理</td>
</tr>
<tr>
<td>可靠性 Reliability</td>
<td>全球分布式采集中心。远程复制进行容灾处理</td>
<td>每个数据分片至少有2份复制</td>
<td>查询过程能够使用任意切片的复制</td>
</tr>
<tr>
<td>安全性 Security</td>
<td>使用TLS 1.2，256bit AES加密</td>
<td>256bit数据加密</td>
<td>使用LTS 1.2，256bit AES加密</td>
</tr>
</tbody></table>
<p>原文链接：<a href="https://mixpanel.com/wp-content/uploads/2018/06/System-architecture_June2018.pdf" target="_blank" rel="noopener">https://mixpanel.com/wp-content/uploads/2018/06/System-architecture_June2018.pdf</a></p>

        
    

    
</div>


                

                <!-- Post Comments -->
                
                    
                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2020/06/hello-world.html" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/avatar.png" alt="linan116's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="#" target="_blank" title="Email Me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                主页
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    归档
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2020/07/">七月 2020<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2020/06/">六月 2020<span class="sidebar_archives-count">1</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">chrome_reader_mode</i>
                
                分类
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
                <li>
                
            </ul>
        </li>
        
    

    <!-- Pages  -->
    
        <li>
            <a href="/about" title="About">
                
                    <i class="material-icons sidebar-material-icons">person</i>
                
                About
            </a>
        </li>
        
    

    <!-- Article Number  -->
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->

    <div class="sidebar-divider"></div>


<!-- Theme Material -->

    <a href="https://github.com/viosey/hexo-theme-material"  class="sidebar-footer-text-a" target="_blank">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
            主题 - Material
            <span class="sidebar-badge badge-circle">i</span>
        </div>
    </a>


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div id="back-to-top" class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    

    <!-- Facebook -->
    

    <!-- Google + -->
    

    <!-- Weibo -->
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    
        <a href="https://github.com/linan116" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-github">
                <span class="visuallyhidden">Github</span>
            </button><!--
     --></a>
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    

    <!-- V2EX -->
    

    <!-- Segmentfault -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;<span year></span>&nbsp;面子和里子
            
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import JS File -->

    <script>lsloader.load("lazyload_js","/js/lazyload.min.js?1BcfzuNXqV+ntF6gq+5X3Q==", true)</script>



    <script>lsloader.load("js_js","/js/js.min.js?Bn9UzEm8RrBSxqyZB0zPjA==", true)</script>



    <script>lsloader.load("np_js","/js/nprogress.js?pl3Qhb9lvqR1FlyLUna1Yw==", true)</script>


<script type="text/ls-javascript" id="NProgress-script">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>













<!-- UC Browser Compatible -->
<script>
	var agent = navigator.userAgent.toLowerCase();
	if(agent.indexOf('ucbrowser')>0) {
		document.write('
<link rel="stylesheet" href="/css/uc.css">
');
	   alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
	}
</script>

<!-- Import prettify js  -->



<!-- Window Load -->
<!-- add class for prettify -->
<script type="text/ls-javascript" id="window-load">
    $(window).on('load', function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });

    
    
</script>

<!-- MathJax Load-->


<!-- Bing Background -->


<script type="text/ls-javascript" id="lazy-load">
    // Offer LazyLoad
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    // Start Queue
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });
</script>

<!-- Custom Footer -->



<script>
    var copyrightNow = new Date().getFullYear();
    var textContent = document.querySelector('span[year]')

    copyrightSince = 2020;
    if (copyrightSince === copyrightNow||copyrightSince === 0000) {
        textContent.textContent = copyrightNow
    } else {
        textContent.textContent = copyrightSince + ' - ' + copyrightNow
    }

    (function(){
        var scriptList = document.querySelectorAll('script[type="text/ls-javascript"]')

        for (var i = 0; i < scriptList.length; ++i) {
            var item = scriptList[i];
            lsloader.runInlineScript(item.id,item.id);
        }
    })()
console.log('\n %c © Material Theme | Version: 1.5.6 | https://github.com/viosey/hexo-theme-material %c \n', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-left-radius:5px;border-bottom-left-radius:5px;', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-right-radius:5px;border-bottom-right-radius:5px;');
</script>

                </main>
            </div>
        </body>
    
</html>
